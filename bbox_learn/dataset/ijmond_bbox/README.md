# IJmond Smoke Detection Citizen Feedback Dataset

The dataset format looks like the following. Notation `r1` and `r2` means records in a dictionary format, downloaded from the [IJmondCAM tool](https://ijmondcam.multix.io/index.html).
```json
{"data": [
  r1,
  r2,
  ...
]}
```

Each record (e.g. `r1`) has the following format. Notations `f1` and `f2` means feedback items in a dictionary format that were provided by users (e.g., citizens, researchers).
```json
{
  "feedback_filtered": [
    f1,
    f2,
    ...
  ],
  "file_path": "bbox_batch_2/1LeRIZ-oQwo-4/34/1LeRIZ-oQwo-4-34-3/",
  "frame_number": 34,
  "frame_timestamp": 1691038644,
  "h_bbox": 22,
  "h_image": 600,
  "id": 1184,
  "image_file_name": "crop.png",
  "label_state": 5,
  "label_state_admin": -1,
  "label_update_time": 1745836455,
  "mask_file_name": "mask.png",
  "url_root": "https://ijmondcam.multix.io/videos/",
  "video": {
    "camera_id": 0,
    "file_name": "1LeRIZ-oQwo-4",
    "id": 757,
    "url_part": "1LeRIZ-oQwo",
    "view_id": 4
  },
  "w_bbox": 26,
  "w_image": 600,
  "x_bbox": 265,
  "y_bbox": 131
}
```

Below is the explanation for all the fields for each record:
- `feedback_filtered`: Feedback from users, which will be explained later
- `file_path`: A string that can be used to construct a link to the image (or segmentation mask)
- `frame_number`: Frame number of the video (`null` means that the image does not belong to a video)
- `frame_timestamp`: UNIX timestamp of the video frame
- `h_bbox`: Height of the bounding box, in pixels
- `h_image`: Height of the image, in pixels
- `id`: ID of the image (could be a video frame)
- `image_file_name`: The file name of the image (used to construct a link to the image)
- `label_state`: State of the label that was created by the normal users, which will be explained later
- `label_state_admin`: State of the label that was created by the admin researcher, which will be explained later
- `label_update_time`: UNIX timestamp indicating the most recent time when the label was updated
- `mask_file_name`: The file name of the binary segmentaion mask (used to construct a link to the mask)
- `url_root`: A string that can be used to construct a link to the video, image, or segmentation mask
- `video`: Information about the video where the image comes from
  - `camera_id`: ID of the camera, 0 means "hoogovens", 1 means "kooksfabriek_1", and 2 means "kooksfabriek_2" (used to construct a link to the video)
  - `file_name`: File name of the video (used to construct a link to the video)
  - `id`: ID of the video
  - `url_part`: A string that can be used to construct a link to the video
  - `view_id`: ID of a view, which means a certain cropped region from a large panorama (see [this image](https://ijmondcam.multix.io/img/home-image.png) for an example)
- `w_bbox`: Width of the bounding box (generated by AI), in pixels
- `w_image`: Width of the image, in pixels
- `x_bbox`: x coordinate (horizontal) of the top-left corner of the box (generated by AI), in pixels
- `y_bbox`: y coordinate (vertical) of the top-left corner of the box (generated by AI), in pixels

Notice that values in the `h_bbox`, `w_bbox`, `x_bbox`, and `y_bbox` fields are relative to the image size in the `w_image` and `h_image` fields. Below is the explaination of `label_state` and `label_state_admin`:
- 0 : One person checked the box; the box is good (or there was no box, and the person agrees)
- 1 : One person checked the box; the person edited the box
- 2 : One person checked the box; the person removed the box due to no smoke (or there was no box, and the person added a box due to smoke)
- 3 : Two people checked the box; they agree that the box is good (terminal state, no need for more feedback)
- 4 : Two people checked the box; they both edited the box (terminal state, no need for more feedback)
- 5 : Two people checked the box; they both removed the box (terminal state, no need for more feedback)
- 6 : Two people checked the box; they give state 0 and 1
- 7 : Two people checked the box; they give state 0 and 2
- 8 : Two people checked the box; they give state 1 and 2
- 9 : Three people checked the box; they give state 0, 1, and 0 (terminal state, probably a good box)
- 10 : Three people checked the box; they give state 0, 1, and 1 (terminal state, probably a box that need editing)
- 11 : Three people checked the box; they give state 0, 2, and 0 (terminal state, probably a good box)
- 12 : Three people checked the box; they give state 0, 2, and 2 (terminal state, probably does not have smoke)
- 13 : Three people checked the box; they give state 1, 2, and 1 (terminal state, probably a box that need editing)
- 14 : Three people checked the box; they give state 1, 2, and 2 (terminal state, probably does not have smoke)
- 15 : Three people checked the box; they give state 0, 1, and 2 (terminal state, probably a box that need editing)
- 16 : Gold standard; the box is good (terminal state)
- 17 : Gold standard; the box needs editing (terminal state)
- 18 : Gold standard; the box should be removed (terminal state)
- -1 : No data; no feedback from people (initial state)
- -2 : Discarded data, by researchers (terminal state)

Below is the python code that you can use to construct the URL for the video and image. Notice that the bounding box URL below shows the box that was created by [a Computer Vision model](https://github.com/MultiX-Amsterdam/ijmond-camera-ai/tree/main/bvm_training).
```python
def build_video_url(record):
    """Build the video URL from record data"""
    camera_names = ["hoogovens", "kooksfabriek_1", "kooksfabriek_2"]
    video = record["video"]
    url_root = record["url_root"]

    src_url = (url_root +
               camera_names[video["camera_id"]] + "/" +
               video["url_part"] + "/" +
               video["file_name"] + ".mp4")
    return src_url


def build_image_url(record):
    """Build the image URL from record data"""
    url_root = record["url_root"]
    file_path = record["file_path"]
    image_file_name = record["image_file_name"]

    # Original image URL
    original_url = url_root + file_path + image_file_name

    # Image with bounding box URL
    bbox_image_file_name = image_file_name.replace("crop.png", "crop_with_bbox.png")
    bbox_url = url_root + file_path + bbox_image_file_name

    return original_url, bbox_url
```

Each feedback in the `feedback_filtered` field (e.g., `f1`) in each record has the following format. The feedback was given by an user who indicated that the bounding box needs editing.
```json
{
  "feedback_code": 1,
  "frame_number": 13,
  "h_bbox": 169,
  "time": 1745597437,
  "w_bbox": 155,
  "x_bbox": 76,
  "y_bbox": 403
}
```

Below is the explanation for all the fields for each human feedback:
- `feedback_code`: Will be explained later
- `frame_number`: The frame number of the video (indicating that the image comes from which video frame)
- `h_bbox`: height of the box, in pixels
- `time`: UNIX timestamp that the user provided the feedback
- `w_bbox`: width of the box, in pixels
- `x_bbox`: x coordinate (horizontal) of the top-left corner of the box, in pixels
- `y_bbox`: y coordinate (vertical) of the top-left corner of the box, in pixels

Notice that values in the `h_bbox`, `w_bbox`, `x_bbox`, and `y_bbox` fields for each feedback are relative to the image size in the `w_image` and `h_image` fields in each record. If `frame_number` for the feedback is `null`, use the frame number in the `frame_number` field in each record. If the bounding box information is all `null`, such as the example below, it means that the user thinks the bounding box looks good and does not need any editing.
```json
{
  "feedback_code": 0,
  "frame_number": 9,
  "h_bbox": null,
  "time": 1746552968,
  "w_bbox": null,
  "x_bbox": null,
  "y_bbox": null
}
```

If the bounding box information is all `-1`, such as the example below, it means that the user thinks the bounding box needs to be removed (which means the AI did a very bad work).
```json
{
  "feedback_code": 2,
  "frame_number": 34,
  "h_bbox": -1,
  "time": 1745836455,
  "w_bbox": -1,
  "x_bbox": -1,
  "y_bbox": -1
}
```

If the bounding box information is all `-2`, it means that the someone resets the data. If the information is all `-3`, it means that the someone discards the data. Typically resetting and discarding actions are made by the researchers (and not normal users).

Below is the definition of feedback code:
- 0: One lay person checked the box; the box is good
- 1: One lay person checked the box; the person edited the box
- 2: One lay person checked the box; the person removed the box due to no smoke
- 3: One researcher checked the box; the box is good
- 4: One researcher checked the box; the person edited the box
- 5: One researcher checked the box; the person removed the box due to no smoke
- 16: Gold standard; the box is good
- 17: Gold standard; the box needs editing
- 18: Gold standard; the box should be removed
- -1: No data; no feedback from people
- -2: Discarded data, by researchers

Gold standard means that the feedback was given by a researcher, and the feedback is used for data quality check.